/* Automad 2.0.0-alpha.48, (c) 2025 Marc Anton Dahmen, MIT license */
import{M as p,a,e as r,k as h}from"./chunk.DFXEN6GE.js";import{a as n,d as o}from"./chunk.G4EF3EQN.js";var d=class extends h{static get observedAttributes(){return["placeholder","name","value"]}get data(){let e=[];return(this.getAttribute("am-data")??"").split(",").forEach(i=>{let s=i.trim();e.push({value:s,title:s})}),e}items=[];itemsFiltered;selectedIndex=null;initialIndex=null;get minInputLength(){return parseInt(this.getAttribute("am-min")??"1")}maxItems=8;input;dropdown;elementClasses=["am-c-dropdown"];inputClasses=["am-f-input"];itemsClasses=["am-c-dropdown__items","am-c-dropdown__items--autocomplete"];linkClass="am-c-dropdown__link";linkActiveClass="am-active";connectedCallback(){this.classList.add(...this.elementClasses),this.listen(window,"AutomadAppStateChange",this.init.bind(this)),this.init()}init(){typeof this.data<"u"&&(this.innerHTML="",this.items=[],this.input=this.createInput(),this.hasAttribute("disabled")||(this.dropdown=n("div",this.itemsClasses,{},this),this.data.forEach(e=>{this.items.push({element:this.createItemElement(e),value:this.createItemValue(e),item:e})}),this.itemsFiltered=this.items,this.registerDropdownEvents(),this.registerInputEvents(),this.update()))}createInput(){let t={type:"text",...this.hasAttribute("disabled")?{disabled:""}:{}},i=a.text(this.elementAttributes.placeholder);return i&&(t.placeholder=i),this.elementAttributes.name&&(t.name=this.elementAttributes.name),this.elementAttributes.value&&(t.value=this.elementAttributes.value),n("input",this.inputClasses,t,this)}createItemElement(e){return n("a",[this.linkClass],{},null,p`$${e.title}`)}createItemValue(e){return e.value.toLowerCase()}renderDropdown(){this.dropdown.innerHTML="",this.itemsFiltered.forEach(e=>{this.dropdown.appendChild(e.element)})}update(){let e=this.input.value.toLowerCase().split(" "),t=0;this.itemsFiltered=[],this.items.forEach(i=>{var s=!0;if(t<this.maxItems){for(var l=0;l<e.length;l++)if(i.value.indexOf(e[l])==-1){s=!1;break}s&&(this.itemsFiltered.push(i),t++)}}),this.selectedIndex=this.initialIndex,this.renderDropdown(),this.toggleActiveItemStyle()}onKeyDownEvent(e){switch(e.keyCode){case 38:this.prev(e);break;case 40:this.next(e);break;case 13:this.select(e);break;case 9:case 27:this.input.blur(),this.close();break}}onKeyUpEvent(e){[38,40,13,9,27].includes(e.keyCode)||(this.update(),this.open())}onMouseOverEvent(e){let t=e.target;t.matches(`.${this.linkClass}`)||(t=t.closest(`.${this.linkClass}`)),this.selectedIndex=Array.from(this.dropdown.children).indexOf(t),this.toggleActiveItemStyle()}registerInputEvents(){this.listen(this.input,"keydown",this.onKeyDownEvent.bind(this)),this.listen(this.input,"keyup",o(this.onKeyUpEvent.bind(this))),this.listen(this.input,"focus",this.open.bind(this)),this.listen(document,"click",e=>{this.contains(e.target)||this.close()})}registerDropdownEvents(){this.listen(this.dropdown,"mouseover",e=>{this.onMouseOverEvent(e)},`.${this.linkClass}`),this.listen(this.dropdown,"click",e=>{this.select(e)},`.${this.linkClass}`)}toggleActiveItemStyle(){this.itemsFiltered.forEach((e,t)=>{e.element.classList.toggle(this.linkActiveClass,t==this.selectedIndex)})}close(){this.selectedIndex=this.initialIndex,this.toggleActiveItemStyle(),this.classList.remove("am-c-dropdown--open")}open(){this.input.value.length>=this.minInputLength&&(this.update(),this.classList.add("am-c-dropdown--open"))}prev(e){e.stopImmediatePropagation(),e.preventDefault(),this.selectedIndex--,this.selectedIndex<0&&(this.selectedIndex=this.itemsFiltered.length-1),this.toggleActiveItemStyle()}next(e){e.stopImmediatePropagation(),e.preventDefault(),this.selectedIndex===null?this.selectedIndex=0:(this.selectedIndex++,this.selectedIndex>this.itemsFiltered.length-1&&(this.selectedIndex=0)),this.toggleActiveItemStyle()}select(e){e.stopImmediatePropagation(),e.preventDefault(),this.selectedIndex!==null&&(this.input.value=this.itemsFiltered[this.selectedIndex].value),this.close(),r("AutomadAutocompleteSelect",this)}};customElements.define("am-autocomplete",d);export{d as a};
