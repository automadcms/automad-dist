/* Automad, (c) Marc Anton Dahmen, MIT license */
import{b as p}from"./chunk.P2SX6LJS.js";import"./chunk.PM2TQVGE.js";import{G as s,J as g,a as i,b as n,c as d,oa as c,v as l}from"./chunk.URMIVSL7.js";import{e as r}from"./chunk.SQMRGQ3J.js";import"./chunk.ZTO3KGQP.js";import"./chunk.2NNYUVDG.js";var o=class extends p{get api(){return"InPageController::edit"}get parallel(){return!1}get watch(){return!0}get initSelf(){return!0}field;page;context;bindings;init(){let t=new URLSearchParams(document.location.search);this.field=t.get("field"),this.page=t.get("page"),this.context=t.get("context"),this.additionalData={field:this.field,context:this.context,init:!0},this.setAttribute("am-api",this.api),c(`${i.pages[this.context]?.title??"404"} (${this.field})`),this.bindings={inPageReturnUrlBinding:new n("inPageReturnUrl",{initial:this.page,modifier:e=>`${i.baseIndex}${e}`}),inPageTitleBinding:new n("inPageTitle",{initial:i.pages[this.context]?.title??"404"}),inPageContextUrlBinding:new n("inPageContextUrl",{initial:this.context,modifier:e=>`${i.baseIndex}${e}`}),inPageFieldBinding:new n("inPageField",{initial:this.field,modifier:e=>s(e)})},d.connectElements(i.root),this.listen(window,"keydown",e=>{e.keyCode===27&&(r("[am-modal-open]")||(e.preventDefault(),e.stopImmediatePropagation(),window.location.href=this.bindings.inPageReturnUrlBinding.value))}),this.listen(document,"click",e=>{e.target.contains(this)&&r("[contenteditable], input, textarea",this)?.focus()})}async processResponse(t){this.additionalData.init=!1,t.code===200&&t.data&&(t.data.saved&&(window.location.href=this.bindings.inPageReturnUrlBinding.value),typeof t.data.value<"u"&&this.render(t))}render(t){let e=g(!0),a="am-textarea-field";for(let[f,u]of Object.entries(e))if(this.field.startsWith(f)){a=u;break}this.innerHTML="",l(a,this,{key:this.field,value:t.data.value,name:"value",isInPage:!0}),this.additionalData.dataFetchTime=t.time}};customElements.define("am-inpage-form",o);export{o as InPageFormComponent};
