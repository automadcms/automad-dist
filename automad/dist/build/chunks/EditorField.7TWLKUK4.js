/* Automad 2.0.0-alpha.48, (c) 2025 Marc Anton Dahmen, MIT license */
import{a as f}from"./chunk.XUX5YWUW.js";import{D as b,e as m,g as l,o as g,p as c,u as v}from"./chunk.DFXEN6GE.js";import{a as n,d as h,e as u}from"./chunk.G4EF3EQN.js";import"./chunk.GP2ROWMN.js";import"./chunk.KC7M4D2V.js";var d=class extends f{editorJS;linkLabel=!1;value;createInput(){let{name:t,id:e,value:o}=this._data;this.setAttribute("name",t),this.value=o;let i=n("div",[],{id:e},this);n("am-alert",["am-u-display-small"],{"am-icon":"window","am-text":"editorSmallDisplayAlert"},i),this.editorJS=v(i,{blocks:this.value.blocks},{onChange:async s=>{let{blocks:r}=await s.saver.save(),p=r?.map(a=>(a.tunes=g(a.tunes??{}),a))||[];JSON.stringify(this.value.blocks)!==JSON.stringify(p)&&(this.value={blocks:[...p]},m("input",this))}},!1),this.attachToolbarPositionObservers(),this.attachPopupHeightObservers()}getValueProvider(){return this}async mutate(t){this.value=t,t.blocks?.length>0?await this.editorJS.editor.render(t):this.editorJS.editor.clear(),this.editorJS.onRender()}query(){return this.value}attachPopupHeightObservers(){this.addListener(l(this,t=>{let e=t.target;if(!e.classList.contains("codex-editor"))return;if(!e.classList.contains("codex-editor--toolbox-opened")){this.style.removeProperty("min-height");return}let o=u(".ce-popover--opened",e);setTimeout(()=>{let i=o.getBoundingClientRect(),s=this.getBoundingClientRect(),r=i.top-s.top+i.height;this.style.minHeight=`${r}px`},0)})),this.addListener(l(this,t=>{let e=t.target;if(e.classList.contains("ce-popover")&&e.closest(".ce-settings")){if(!e.classList.contains("ce-popover--opened")){this.style.removeProperty("min-height");return}setTimeout(()=>{let o=e.getBoundingClientRect(),i=this.getBoundingClientRect(),s=o.top-i.top+o.height;this.style.minHeight=`${s}px`},0)}}))}attachToolbarPositionObservers(){this.listen(this,"keydown",t=>{if(t.key!="/")return;let o=t.target.closest(".ce-block");c.updateToolbarPosition(o)}),this.listen(this,"mouseover",h(t=>{t.stopPropagation();let o=t.target.closest(".ce-block");c.updateToolbarPosition(o)},10),".ce-block")}};b.add("am-editor-field");customElements.define("am-editor-field",d);export{d as EditorFieldComponent};
