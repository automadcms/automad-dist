/* Automad 2.0.0-alpha.48, (c) 2025 Marc Anton Dahmen, MIT license */
import{b as A}from"./chunk.42CLRD5U.js";import{M as y,a as p,b as v,c as f,e as d,ja as $,k as g,q as C,qa as u,v as T,y as _}from"./chunk.DFXEN6GE.js";import{a as s,d as b,e as c,f as m}from"./chunk.G4EF3EQN.js";var w="am-new-component-button",r=class extends A{static TAG_NAME="am-component-collection-form";get initSelf(){return!0}get auto(){return!0}isInitialized=!1;fetchTime;sortable;get deduplicationSettings(){return{getFormData:()=>{let e=this.formData;return e.fetchTime=null,e},enabled:!0}}get formData(){return this.isInitialized?{components:m(a.TAG_NAME,this).map(t=>t.data),fetchTime:this.fetchTime}:{}}add(e,t=null){let i=s(a.TAG_NAME,[],{},this);return t!==null&&t.insertAdjacentElement("afterend",i),i.data=e,i}init(){this.classList.add("am-u-flex","am-u-flex--column","am-u-flex--gap"),m(`.${w}`).forEach(e=>{this.listen(e,"click",()=>{this.add({id:u(),name:"",blocks:[],collapsed:!1})})}),this.listen(window,"AutomadContentPublished",()=>{this.fetchTime=Math.ceil(new Date().getTime()/1e3)})}async processResponse(e){e.data?.components?(this.sortable?.destroy(),this.innerHTML="",e.data.components.forEach(t=>{this.add(t)}),this.sortable=new C(this,{handle:".am-c-component-editor__handle, .am-c-component-editor__name",animation:200,draggable:a.TAG_NAME,ghostClass:"am-c-component-editor--ghost",chosenClass:"am-c-component-editor--chosen",dragClass:"am-c-component-editor--drag",direction:"vertical",onStart:()=>{m("am-editor-field",this).forEach(t=>{t.style.pointerEvents="none"})},onEnd:()=>{m("am-editor-field",this).forEach(t=>{t.style.removeProperty("pointer-events")})},onChange:t=>{t.item.init(),this.submit()}})):(d("AutomadContentSaved"),d("AutomadAppStateRequireUpdate")),this.fetchTime=e.time,this.isInitialized=!0}disconnectedCallback(){this.sortable?.destroy(),super.disconnectedCallback()}};customElements.define(r.TAG_NAME,r);var a=class extends g{static TAG_NAME="am-component-editor";_data;editor;get data(){return this._data.blocks=this.editor.value.blocks,this._data}set data(e){this._data=e,setTimeout(this.init.bind(this),0)}init(){let e=this._data.name.length>0,t=`component-name-${this._data.id}-${Array.from(this.parentNode?.childNodes??[])?.indexOf(this)??0}`;f.delete(t);let i=new v(t,{onChange:o=>{this._data.name=o,d("change",this.editor)},initial:this._data.name}),n=async()=>{this.classList.add("am-c-component-editor"),this.innerHTML=y`<div class="${"am-c-component-editor__header"}"><div class="${"am-c-component-editor__name"}" ${"am-bind"}="${t}" ${"am-bind-to"}="title" ><i></i><span ${"am-bind"}="${t}"> ${this._data.name}</span></div><div class="${"am-c-component-editor__tools"}"></div><div class="${"am-c-component-editor__handle"}"><i class="bi bi-grip-vertical"></i></div></div><div class="${"am-c-component-editor__main"}"></div>`,f.connectElements(this);let o=c(".am-c-component-editor__tools",this),l=c(".am-c-component-editor__main",this),E=c(".am-c-component-editor__name",this),M=s("span",[],{},o,'<i class="bi bi-pencil"></i>'),k=s("span",[],{},o,'<i class="bi bi-copy"></i>'),D=s("span",[],{},o,'<i class="bi bi-trash3"></i>');this.toggleEditor(l,E,this._data.collapsed),this.listen(E,"click",()=>{this.toggleEditor(l,E,!this._data.collapsed)}),this.listen(k,"click",()=>{this.closest(r.TAG_NAME).add({id:u(),name:`${this._data.name} (${p.text("componentCopy")})`,blocks:this.data.blocks,collapsed:!1},this).fireOnReady()}),this.listen(M,"click",()=>{this.setName(h=>{i.value=h})}),this.listen(D,"click",async()=>{if(await $(`${p.text("componentConfirmRemoval")} (${this._data.name})`)){let h=this.closest(r.TAG_NAME);this.remove(),h.submit()}}),this.editor=T("am-editor-field",l,{value:{blocks:this._data.blocks},name:"",key:"",label:""})};e?n():this.setName(o=>{i.value=o,n(),this.fireOnReady()})}fireOnReady(){setTimeout(async()=>{await this.editor.editorJS.editor.isReady,d("change",this.editor)},0)}toggleEditor(e,t,i){let n=c("i",t);this._data.collapsed=i,e.classList.toggle("am-u-display-none",this._data.collapsed),n.className=`bi bi-chevron-${this._data.collapsed?"right":"down"}`,d("change",this.editor)}setName(e){let{modal:t,body:i,button:n}=_(p.text("componentName"),p.text("ok")),o=s("input",["am-f-input"],{value:this._data.name??""},i);n.setAttribute("disabled",""),t.open(),t.listen(o,"input paste cut",b(()=>{o.value.length>0?n.removeAttribute("disabled"):n.setAttribute("disabled","")},100)),t.listen(n,"click",()=>{let l=o.value;l.length&&(e(l),t.close())}),t.listen(t,"AutomadModalClose",()=>{o.value.length==0&&this.remove()})}};customElements.define(a.TAG_NAME,a);export{a,w as b,r as c};
