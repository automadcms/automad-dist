/* Automad, (c) Marc Anton Dahmen, MIT license */
import{b as N}from"./chunk.P2SX6LJS.js";import"./chunk.PM2TQVGE.js";import{E as x,G as L,H as A,I as G,K as P,M as S,O as C,a as e,b as u,da as D,e as M,oa as f,v as m,w as E}from"./chunk.URMIVSL7.js";import{a as s}from"./chunk.SQMRGQ3J.js";import"./chunk.ZTO3KGQP.js";import"./chunk.2NNYUVDG.js";var $=F=>{let t=new u("pageDataFetchTime",{initial:F.time});return{slugBinding:new u("pageSlug",{initial:F.data.fields[e.reservedFields.SLUG]}),pageDataFetchTimeBinding:t}},b=class extends N{get deduplicationSettings(){return{getFormData:t=>{let n=G(t);return n.dataFetchTime=null,n},enabled:!0}}sections;bindings;get parallel(){return!1}get auto(){return!0}get initSelf(){return!0}init(){this.sections=E(this),this.listen(window,"AutomadContentPublished",()=>{this.bindings&&(this.bindings.pageDataFetchTimeBinding.value=Math.ceil(new Date().getTime()/1e3))})}mainSettings({section:t,url:n,fields:a,template:r,readme:T,shared:v}){let i=(l,g,p="",y={},B=t)=>{let U={key:g,value:a[g],name:`data[${g}]`,label:p};return m(l,B,U,[],y)},o=s("div",["am-u-flex","am-u-flex--column","am-u-flex--gap"],{},t),d=i("am-title-field",e.reservedFields.TITLE,"",{required:""},o);new u("title",{input:d.input,modifier:l=>(f(l),l)}),s("a",[],{href:`${e.baseIndex}${n}`},o).innerHTML=S`<span class="${"am-c-icon-text"}"><i class="bi bi-link"></i><span>${e.baseIndex}${n}</span></span>`,i("am-toggle-large-field",e.reservedFields.PRIVATE,e.text("keepPagePrivate"));let h=s("am-page-template-field",[],{},t);h.data={fields:a,template:r,themeKey:e.reservedFields.THEME,readme:T},i("am-syntax-theme-select-field",e.reservedFields.SYNTAX_THEME,L(e.reservedFields.SYNTAX_THEME)),i("am-toggle-field",e.reservedFields.HIDDEN,e.text("hidePage"));let c=s("div",["am-l-grid","am-l-grid--auto"],{},t);i("am-date-field",e.reservedFields.DATE,e.text("date"),{},c),e.system.i18n?s("input",[],{type:"hidden",name:`data[${e.reservedFields.LANG_CUSTOM}]`,value:a[e.reservedFields.LANG_CUSTOM]},t):m("am-input-field",c,{key:e.reservedFields.LANG_CUSTOM,value:a[e.reservedFields.LANG_CUSTOM],name:`data[${e.reservedFields.LANG_CUSTOM}]`,label:e.text("langAttr"),placeholder:v[e.reservedFields.LANG_CUSTOM]||"en"}),n!="/"&&m("am-input-field",t,{key:e.reservedFields.SLUG,value:a[e.reservedFields.SLUG],name:`data[${e.reservedFields.SLUG}]`,label:e.text("pageSlug")},[],{"am-bind":"pageSlug","am-bind-to":"value"}),i("am-url-field",e.reservedFields.URL,e.text("redirectPage")),i("am-page-tags-field",e.reservedFields.TAGS,e.text("pageTags")),i("am-input-field",e.reservedFields.META_TITLE,e.text("metaTitle")),i("am-textarea-field",e.reservedFields.META_DESCRIPTION,e.text("metaDescription")),i("am-image-field",e.reservedFields.OPEN_GRAPH_IMAGE,e.text("openGraphImage"))}pageNotFound(){this.innerHTML=S`<am-alert ${"am-icon"}="x-circle" ${"am-text"}="${e.text("pageNotFoundError")} âŸ¶ ${D()}" ></am-alert>`}async processResponse(t){if(t.code===404){this.pageNotFound(),C().error("Page not found");return}if(t.code===200&&(M("AutomadContentSaved"),this.bindings&&(this.bindings.pageDataFetchTimeBinding.value=t.time),!!t.data)){if(this.bindings||(this.bindings=$(t)),t.data.updateUI){this.bindings.slugBinding.value=t.data.slug??"",await e.updateState();return}this.render(t)}}render(t){let{url:n,fields:a,shared:r,template:T,readme:v}=t.data;if(!a)return;s("input",[],{type:"hidden","am-bind":"pageDataFetchTime","am-bind-to":"value",name:"dataFetchTime"},this);let i=e.reservedFields.THEME,o=e.themes;f(a.title);let d=null;a[i]?d=o[a[i]]:d=o[r[i]];let h=d?.labels??{},c=d?.tooltips??{},l=d?.options??{},g=P(a);this.mainSettings({section:this.sections.settings,url:n,fields:a,template:T,readme:v,shared:r}),x(a,this.sections,r),Object.keys(this.sections).forEach(p=>{A({section:this.sections[p],fields:g[p],labels:h,tooltips:c,themeOptions:l,renderEmptyAlert:p!="customizations",shared:r})})}};customElements.define("am-page-data-form",b);export{b as PageDataFormComponent};
