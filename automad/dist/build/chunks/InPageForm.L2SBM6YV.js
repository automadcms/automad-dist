/* Automad 2.0.0-alpha.47, (c) 2025 Marc Anton Dahmen, MIT license */
import{b as f}from"./chunk.5AO24ZZM.js";import"./chunk.MZK2ONP3.js";import{G as g,J as p,a as i,b as n,c as d,oa as c,t as s,v as l}from"./chunk.ETUXSY6N.js";import{e as a}from"./chunk.TNS2LIBN.js";import"./chunk.44XCHEAG.js";import"./chunk.EPACJLJA.js";var o=class extends f{get api(){return"InPageController::edit"}get parallel(){return!1}get watch(){return!0}get initSelf(){return!0}init(){let e=new URLSearchParams(document.location.search);this.field=e.get("field"),this.page=e.get("page"),this.context=e.get("context"),this.additionalData={field:this.field,context:this.context,init:!0},this.setAttribute("am-api",this.api),c(`${i.pages[this.context]?.title??"404"} (${this.field})`),this.bindings={inPageReturnUrlBinding:new n("inPageReturnUrl",{initial:this.page,modifier:t=>`${i.baseIndex}${t}`}),inPageTitleBinding:new n("inPageTitle",{initial:i.pages[this.context]?.title??"404"}),inPageContextUrlBinding:new n("inPageContextUrl",{initial:this.context,modifier:t=>`${i.baseIndex}${t}`}),inPageFieldBinding:new n("inPageField",{initial:this.field,modifier:t=>g(t)})},d.connectElements(i.root),this.listen(window,"keydown",t=>{t.keyCode===27&&(a("[am-modal-open]")||(t.preventDefault(),t.stopImmediatePropagation(),window.location.href=this.bindings.inPageReturnUrlBinding.value))}),this.listen(document,"click",t=>{t.target.contains(this)&&(a("[contenteditable], input, textarea",this)?.focus(),a(s.TAG_NAME)?.editor.caret.setToLastBlock("end"))}),super.init()}async processResponse(e){this.additionalData.init=!1,await super.processResponse(e),e.code===200&&e.data&&(e.data.saved&&(window.location.href=this.bindings.inPageReturnUrlBinding.value),typeof e.data.value<"u"&&this.render(e))}render(e){let t=p(!0),r="am-textarea-field";for(let[u,m]of Object.entries(t))if(this.field.startsWith(u)){r=m;break}this.innerHTML="",l(r,this,{key:this.field,value:e.data.value,name:"value",isInPage:!0}),this.additionalData.dataFetchTime=e.time}};customElements.define("am-inpage-form",o);export{o as InPageFormComponent};
