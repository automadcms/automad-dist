/* Automad 2.0.0-alpha.47, (c) 2025 Marc Anton Dahmen, MIT license */
import{a as I,b as T,c as C}from"./chunk.VA6R7VVG.js";import{M as u,P as y,S as p,a as t,c as S,da as b,k as $}from"./chunk.ETUXSY6N.js";import{a as m,d as h,e as v,f}from"./chunk.TNS2LIBN.js";import"./chunk.44XCHEAG.js";import{c as D}from"./chunk.EPACJLJA.js";var k=D(I());var N=e=>{e.error&&y(e.error),e.reload&&t.reload(),e.redirect&&t.root.setView(e.redirect)},x=e=>{let n=e.url==b()?"am-c-nav__item--active":"",a=t.system.i18n&&e.url==="/"?"globe":t.system.i18n&&e.parentUrl==="/"?"translate":e.private?"eye-slash-fill":"file-earmark-text",r=n?'am-bind="title" am-bind-to="textContent"':"",o=n?'am-bind="publicationState" am-bind-to="am-publication-state"':"";return u`<span class="${"am-c-nav__item"} ${n}" title="${e.url}" ${"am-publication-state"}="${e.publicationState}" ${o} ><am-link class="${"am-c-nav__link"}" ${"am-target"}="${"page"}?url=${encodeURIComponent(e.url)}" ><i class="bi bi-${a}"></i><span>${t.system.i18n&&e.parentUrl==="/"?`${e.url.replace("/","")} &mdash; `:""}<span ${r}>$${e.title}</span></span></am-link></span>`},F=async e=>{let{movedNode:n,targetParentNode:a,srcParentNode:r}=e,o=a.data,L=r.data,g=n.data.url,l=[],P=f("sortable-tree-node",v(i.TAG_NAME)),c=s=>{P.forEach(d=>{d.setAttribute("draggable",s)})};if(c("false"),a.subnodesData.forEach(s=>{l.push(s.path)}),o.path!=L.path){let s=t.addNavigationLock(),d=o.url,M=await p("PageController::move",{url:g,targetPage:d,layout:JSON.stringify(l)});c("true"),t.removeNavigationLock(s),N(M);return}let A=t.addNavigationLock(),w=o.path,E=await p("PageController::updateIndex",{url:g,parentPath:w,layout:JSON.stringify(l)});c("true"),t.removeNavigationLock(A),N(E)},R=async()=>!t.navigationIsLocked,O=h(e=>{e.target.closest("sortable-tree-node").collapse(!1)},1200),i=class extends ${static{this.TAG_NAME="am-nav-tree"}connectedCallback(){this.listen(window,"AutomadAppStateChange",this.init.bind(this)),this.init(),this.listen(this,"dragenter",O,"sortable-tree-node")}init(){this.classList.add("am-c-nav"),this.tree?.destroy(),this.innerHTML="";let n=Object.values(t.pages);m("span",["am-c-nav__label"],{},this,u`<span class="${"am-u-flex"} ${"am-u-flex--gap"} ${"am-u-flex--align-center"}"> ${t.text("sidebarPages")} &mdash; ${n.length}</span>`);let a=b(),r=T(n);if(this.tree=new k.default({nodes:r,element:this,initCollapseLevel:1,styles:C,stateId:"nav",renderLabel:x,onChange:F,confirm:R}),a){let o=this.tree.findNode("url",a);o?.reveal(),o?.scrollIntoView({block:"end"})}S.connectElements(this)}disconnectedCallback(){this.tree?.destroy(),super.disconnectedCallback()}};customElements.define(i.TAG_NAME,i);export{i as NavTreeComponent};
