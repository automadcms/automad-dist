/* Automad, (c) Marc Anton Dahmen, MIT license */
import{a as B}from"./chunk.Q44RWON7.js";import{$ as C,S as v,T as a,V as f,W as y,Y as b,_ as S,a as t,ba as P,c as r,ca as n,e as h,f as s,h as m,i as u,j as g,k as w}from"./chunk.KG3NJGTQ.js";import{a as c,f as p}from"./chunk.SQMRGQ3J.js";import"./chunk.ZTO3KGQP.js";import"./chunk.2NNYUVDG.js";var d=class extends w{static get observedAttributes(){return["base-index","base-url"]}connectedCallback(){this.init()}setView(e){B.toggle(!1),e&&window.history.pushState(null,null,e),this.update()}async init(){this.classList.add("am-c-root"),g(),S(b()),this.progressBar(10),await t.bootstrap(this),await this.update(),s(window,"popstate",()=>{t.root.update()}),m(),u(),this.validateSession(),n.addListeners()}async update(){h("AutomadBeforeUpdateView",window);let e=p("[am-modal-open]");e&&(e.forEach(o=>{o.close()}),await new Promise(o=>setTimeout(o,250))),this.progressBar(20),this.removeListeners(),t.isReady=!1,P(),r.reset(),n.new(),await t.updateState(),this.progressBar(40);let i=f();if(!i)return;let l=c(y(i),[],{}).init();this.progressBar(60),await a(),this.progressBar(80),this.innerHTML="",this.appendChild(l),await a(),r.connectElements(this),C(this),t.checkForSystemUpdate(),t.checkForOutdatedPackages(),t.restoreFilterAndScroll(),this.progressBar(100),t.isReady=!0}async validateSession(){let e=async()=>{if(document.visibilityState==="visible"){let i=await v("SessionController::validate",{csrfTokenValidation:1});(i.code||403)===403&&t.reload(),i.redirect&&this.setView(i.redirect)}};s(document,"visibilitychange",e.bind(this)),s(window,"focus",e.bind(this))}progressBar(e){if(this.classList.toggle("am-c-root--loading",e>0&&e<100),e>0){this.style.setProperty("--progress",`${e}%`);return}setTimeout(()=>{this.style.setProperty("--progress",`${e}%`)},0)}};customElements.define("am-root",d);export{d as RootComponent};
