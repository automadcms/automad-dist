/* Automad 2.0.0-alpha.47, (c) 2025 Marc Anton Dahmen, MIT license */
import{b as A}from"./chunk.5AO24ZZM.js";import{M as y,a as p,b as v,c as b,e as d,ja as $,k as g,q as C,qa as u,v as T,y as _}from"./chunk.ETUXSY6N.js";import{a as s,d as f,e as c,f as m}from"./chunk.TNS2LIBN.js";var w="am-new-component-button",r=class extends A{constructor(){super(...arguments);this.isInitialized=!1}static{this.TAG_NAME="am-component-collection-form"}get initSelf(){return!0}get auto(){return!0}get deduplicationSettings(){return{getFormData:()=>{let t=this.formData;return t.fetchTime=null,t},enabled:!0}}get formData(){return this.isInitialized?{components:m(a.TAG_NAME,this).map(e=>e.data),fetchTime:this.fetchTime}:{}}connectedCallback(){this.classList.add("am-u-flex","am-u-flex--column","am-u-flex--gap"),m(`.${w}`).forEach(t=>{this.listen(t,"click",()=>{this.add({id:u(),name:"",blocks:[],collapsed:!1})})})}add(t,e=null){let o=s(a.TAG_NAME,[],{},this);return e!==null&&e.insertAdjacentElement("afterend",o),o.data=t,o}init(){super.init(),this.listen(window,"AutomadContentPublished",()=>{this.fetchTime=Math.ceil(new Date().getTime()/1e3)})}async processResponse(t){await super.processResponse(t),t.data?.components?(this.sortable?.destroy(),this.innerHTML="",t.data.components.forEach(e=>{this.add(e)}),this.sortable=new C(this,{handle:".am-c-component-editor__handle, .am-c-component-editor__name",animation:200,draggable:a.TAG_NAME,ghostClass:"am-c-component-editor--ghost",chosenClass:"am-c-component-editor--chosen",dragClass:"am-c-component-editor--drag",direction:"vertical",onStart:()=>{m("am-editor-field",this).forEach(e=>{e.style.pointerEvents="none"})},onEnd:()=>{m("am-editor-field",this).forEach(e=>{e.style.removeProperty("pointer-events")})},onChange:e=>{e.item.init(),this.submit()}})):(d("AutomadContentSaved"),d("AutomadAppStateRequireUpdate")),this.fetchTime=t.time,this.isInitialized=!0}disconnectedCallback(){this.sortable?.destroy(),super.disconnectedCallback()}};customElements.define(r.TAG_NAME,r);var a=class extends g{static{this.TAG_NAME="am-component-editor"}get data(){return this._data.blocks=this.editor.value.blocks,this._data}set data(n){this._data=n,setTimeout(this.init.bind(this),0)}init(){let n=this._data.name.length>0,t=`component-name-${this._data.id}-${Array.from(this.parentNode?.childNodes??[])?.indexOf(this)??0}`;b.delete(t);let e=new v(t,{onChange:i=>{this._data.name=i,d("change",this.editor)},initial:this._data.name}),o=async()=>{this.classList.add("am-c-component-editor"),this.innerHTML=y`<div class="${"am-c-component-editor__header"}"><div class="${"am-c-component-editor__name"}" ${"am-bind"}="${t}" ${"am-bind-to"}="title" ><i></i><span ${"am-bind"}="${t}"> ${this._data.name}</span></div><div class="${"am-c-component-editor__tools"}"></div><div class="${"am-c-component-editor__handle"}"><i class="bi bi-grip-vertical"></i></div></div><div class="${"am-c-component-editor__main"}"></div>`,b.connectElements(this);let i=c(".am-c-component-editor__tools",this),l=c(".am-c-component-editor__main",this),E=c(".am-c-component-editor__name",this),M=s("span",[],{},i,'<i class="bi bi-pencil"></i>'),k=s("span",[],{},i,'<i class="bi bi-copy"></i>'),D=s("span",[],{},i,'<i class="bi bi-trash3"></i>');this.toggleEditor(l,E,this._data.collapsed),this.listen(E,"click",()=>{this.toggleEditor(l,E,!this._data.collapsed)}),this.listen(k,"click",()=>{this.closest(r.TAG_NAME).add({id:u(),name:`${this._data.name} (${p.text("componentCopy")})`,blocks:this.data.blocks,collapsed:!1},this).fireOnReady()}),this.listen(M,"click",()=>{this.setName(h=>{e.value=h})}),this.listen(D,"click",async()=>{if(await $(`${p.text("componentConfirmRemoval")} (${this._data.name})`)){let h=this.closest(r.TAG_NAME);this.remove(),h.submit()}}),this.editor=T("am-editor-field",l,{value:{blocks:this._data.blocks},name:"",key:"",label:""})};n?o():this.setName(i=>{e.value=i,o(),this.fireOnReady()})}fireOnReady(){setTimeout(async()=>{await this.editor.editorJS.editor.isReady,d("change",this.editor)},0)}toggleEditor(n,t,e){let o=c("i",t);this._data.collapsed=e,n.classList.toggle("am-u-display-none",this._data.collapsed),o.className=`bi bi-chevron-${this._data.collapsed?"right":"down"}`,d("change",this.editor)}setName(n){let{modal:t,body:e,button:o}=_(p.text("componentName"),p.text("ok")),i=s("input",["am-f-input"],{value:this._data.name??""},e);o.setAttribute("disabled",""),t.open(),t.listen(i,"input paste cut",f(()=>{i.value.length>0?o.removeAttribute("disabled"):o.setAttribute("disabled","")},100)),t.listen(o,"click",()=>{let l=i.value;l.length&&(n(l),t.close())}),t.listen(t,"AutomadModalClose",()=>{i.value.length==0&&this.remove()})}};customElements.define(a.TAG_NAME,a);export{a,w as b,r as c};
